<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BookStore || Nhà sách trực tuyến</title>

    <!--Bootstrap 5 CSS -->
    <link href="module/bootstrap-5.3.3-dist/css/bootstrap.min.css" rel="stylesheet" />
    <!--Font Awesome 5-->
    <link rel="stylesheet" href="module/fontawesome/css/all.min.css" />

    <!-- Popper -->

    <!--Bootstrap JS -->
    <script src="module/bootstrap-5.3.3-dist/js/bootstrap.min.js"></script>
    <script src="module/bootstrap-5.3.3-dist/js/bootstrap.bundle.min.js"></script>
    <!--Jquery -->
    <script src="module/jquery/jquery-3.7.1.min.js"></script>

    <!-- Link File CSS -->
    <link rel="stylesheet" href="asset/css/style.css" />

    <!-- link Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />

    <!-- put data in localstogaren -->
    <script src="asset/js/data.js"></script>
</head>

<body>
    <header>
        <nav class=" d-flex row w-100 m-auto px-lg-5 pb-3 pb-lg-0">
            <!-- Logo -->
            <div class="logo d-flex justify-content-center col-12 col-lg-auto pt-2 pt-lg-0">
                <a href="index.html"><img src="asset/image/logo.jpg" alt="BookStore" width="125px" /></a>
            </div>

            <!-- Thẻ xuống hàng Mobile -->
            <div class="col-12 col-lg-auto">
                <hr>
            </div>

            <!-- Danh mục Pc -->
            <div class="nav-links d-none d-lg-block col-lg">
                <a href="index.html">Trang chủ</a>
                <a href="produce.html">Sản phẩm</a>
                <a href="imfomation.html">Giới thiệu</a>
                <a href="#contact">Liên hệ</a>
            </div>

            <!-- Danh mục Mobile - Btn -->
            <div class="col-auto right-nav d-lg-none">
                <i class="fas fa-bars" data-bs-toggle="offcanvas" data-bs-target="#offcanvasExample"></i>
            </div>

            <!-- Danh mục Mobile - Container -->
            <div class="offcanvas offcanvas-start" tabindex="-1" id="offcanvasExample"
                aria-labelledby="offcanvasExampleLabel">
                <div class="offcanvas-header">
                    <h5 class="offcanvas-title" id="offcanvasExampleLabel">Offcanvas</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
                </div>
                <div class="offcanvas-body">
                    <div>
                        Some text as placeholder. In real life you can have the elements you have chosen. Like, text,
                        images, lists,
                        etc.
                    </div>
                    <div class="dropdown mt-3">
                        <button class="btn btn-secondary dropdown-toggle" type="button" data-bs-toggle="dropdown">
                            Dropdown button
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#">Action</a></li>
                            <li><a class="dropdown-item" href="#">Another action</a></li>
                            <li><a class="dropdown-item" href="#">Something else here</a></li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Card & User - Icon -->
            <div class="col col-lg-4 text-left">
                <form action="" id="search-form">
                    <div class="input-group">
                        <input type="text" id="search-input" class="form-control" placeholder="Nhập tên sách..."
                            aria-label="Recipient's username" aria-describedby="button-addon2">
                        <button class="btn btn-outline-secondary" type="submit" id="Search"><i
                                class="fa-solid fa-magnifying-glass"></i></button>
                    </div>
                </form>
            </div>

            <!-- Card & User - Container -->
            <div class="right-nav d-flex col-auto">
                <a href="#" class="d-none right-nav-icon">
                    <i class="fa-solid fa-magnifying-glass"></i>
                    <span>Tìm kiếm</span>
                </a>
                <a href="cart.html" class="cartyuyy right-nav-icon">
                    <i class="fa-solid fa-cart-shopping"></i>
                    <span>Giỏ hàng</span>
                </a>
                <div class="dropdown">
                    <a class="right-nav-icon" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        <i class="fas fa-user"></i>
                        <span id="user">Tài khoản</span>
                    </a>
                    <ul class="dropdown-menu">
                        <li><a class="dropdown-item" href="register.html">Đăng ký</a></li>
                        <li><a class="dropdown-item" href="login.html">Đăng nhập</a></li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>

    <section class="section home">
        <div class="container">
            <div class="row">
                <!-- giỏ hàng -->
                <div class="col-lg-8">
                    <div class="card px-2">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th scope="col"></th>
                                    <th scope="col"></th>
                                    <th scope="col" style="width: 18%;">Đơn giá</th>
                                    <th scope="col" style="width: 18%;">Số lượng</th>
                                    <th scope="col" style="width: 24%;">Tổng</th>
                                    <th scope="col"></th>
                                </tr>
                            </thead>
                            <tbody id="listCart">
                                <!--                                 
                                <tr class="align-middle" id="itemCart-1">
                                    <td class="text-center">
                                        <img src="asset/image/book-1.jpg" alt="Harry Potter" width="100px" />
                                    </td>
                                    <td>Harry Potter</td>
                                    <td>20$</td>
                                    <td>
                                        <input type="number" class="form-control w-75" value="2">
                                    </td>
                                    <td class="book-price"><span>$40</span></td>
                                    <td>
                                        <button class="btn btn-sm deleteCart"><i class="fas fa-trash"></i></button>
                                    </td>
                                </tr>
                                 -->
                            </tbody>
                        </table>
                    </div>
                </div>
                <!-- thanh toán -->
                <div class="col-lg-4">
                    <div class="card p-3">
                        <div class="row d-flex align-items-center">
                            <div class="col-auto">
                                <h4 class="">Tổng cộng:</h4>
                            </div>
                            <div class="col text-end book-price" id="totalCart">
                            </div>
                        </div>
                        <div class="row mt-3">
                            <div class="col">
                                <button class="btn btn--custom w-100" data-bs-toggle="modal"
                                    data-bs-target="#paymentConfirmationModal">Thanh toán</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
    </section>
    <!-- Modal -->
    <div class="modal fade" id="paymentConfirmationModal" data-bs-backdrop="static" data-bs-keyboard="false"
        tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="staticBackdropLabel">Xác nhận thanh toán</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">

                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Hủy</button>
                    <button type="button" id="paymentConfirmation" class="btn btn--custom" data-bs-dismiss="modal">Xác
                        nhận thanh toán</button>
                </div>
            </div>
        </div>
    </div>

    <footer id="contact">
        <div class="contnaier">
            <div class="big-rows">
                <p>
                    Cung cấp những cuốn sách chất lượng nhất với dịch vụ tận tâm. Khám
                    phá thế giới sách cùng chúng tôi!
                </p>
                <div class="coical-icon">
                    <a href="#"><i class="fa-brands fa-facebook-f"></i></a>
                    <a href="#"><i class="fa-brands fa-twitter"></i></a>
                    <a href="#"><i class="fa-brands fa-instagram"></i></a>
                    <a href="#"><i class="fa-brands fa-google-plus-g"></i></a>
                </div>
            </div>

            <div class="row">
                <h2 class="title">Thông Tin</h2>
                <div class="links">
                    <a href="#">Cửa Hàng Của Chúng Tôi</a>
                    <a href="#">Giới Thiệu</a>
                    <a href="#">Kinh Doanh</a>
                    <a href="#">Giao Hàng</a>
                </div>
            </div>

            <div class="row">
                <h2 class="title">Dịch Vụ</h2>
                <div class="links">
                    <a href="#">Điều khoản sử dụng</a>
                    <a href="#">Chính sách bảo mật thông tin cá nhân</a>
                    <a href="#">Giới thiệu BookStore</a>
                    <a href="#">Hệ thống trung tâm - nhà sách</a>
                </div>
            </div>

            <div class="row">
                <h2 class="title">Liên hệ</h2>
                <div class="links">
                    <p>Địa chỉ: 123 Đường ABC, Quận XYZ, Thành phố HCM</p>
                    <p>Số điện thoại: (012) 345-6789</p>
                    <p>Email: info@bookstore.com</p>
                </div>
            </div>

        </div>
        <div class="bottom-footer">
            <div class="content">
                <p>&copy; 2024 | Tên tác giả</p>

                <div class="payment-img">
                    <img src="asset/image/payment-1.png" alt="" />
                    <img src="asset/image/payment-2.png" alt="" />
                    <img src="asset/image/payment-3.png" alt="" />
                    <img src="asset/image/payment-4.png" alt="" />
                </div>
            </div>
        </div>
    </footer>
    <script src="asset/js/script.js"></script>

    <script>
        $(document).ready(function () {
            //lấy dữ liệu từ localstorage
            var carts = JSON.parse(localStorage.getItem('cart'));
            var books = JSON.parse(localStorage.getItem('book'));

            // Hiển thị tổng cộng
            function tocart() {
                var carts = JSON.parse(localStorage.getItem('cart'));
                var total = 0;
                if (carts && carts.length > 0) {
                    carts.forEach(cart => {
                        var book = books.find(book => book.id === cart.id_book);
                        if (book) {
                            total += cart.quantity * book.price;
                        }
                    });
                }

                $('#totalCart').text('$' + total.toLocaleString('vi-VN') + ' đ');
            }
            tocart();

            // Render a cart item
            function renderCartItem(cart, book) {
                var totalPrice = cart.quantity * book.price;
                var row = `
                <tr class="align-middle" id="itemCart-${cart.id}">
                    <a href="product-detail.html?id=${book.id}"></a>

                <td class="text-center">
                    <a href="product-detail.html?id=${book.id}">
                        <img src="${book.image}" alt="image" width="100px" />
                        </a>
                </td>
                <td>
                    <a href="product-detail.html?id=${book.id}">
                        ${book.title} - ${book.author}
                    </a>
                </td>
                <td>$${book.price.toLocaleString('vi-VN')} đ</td>
                <td>
                    <input data-id="${cart.id}" type="number" class="form-control w-50 quantityCart" value="${cart.quantity}">
                </td>
                <td class="book-price"><span>$${totalPrice.toLocaleString('vi-VN')} đ</span></td>
                <td>
                    <button data-id="${cart.id}" class="btn btn-sm deleteCart"><i class="fas fa-trash"></i></button>
                </td>
            </tr>
            `;

                $('#listCart').append(row);
            }

            // Hiển thị danh sách giỏ hàng
            function displayCart() {
                var carts = JSON.parse(localStorage.getItem('cart'));
                $('#listCart').empty();
                if (carts && carts.length > 0) {
                    carts.forEach(cart => {
                        var book = books.find(book => book.id === cart.id_book);
                        if (book) {
                            renderCartItem(cart, book);
                        }
                    });
                } else {
                    $('#listCart').append('<tr><td colspan="6" class="text-center">Không có sản phẩm nào trong giỏ hàng</td></tr>');
                }

            }
            displayCart();


            // Xóa sản phẩm khỏi giỏ hàng
            $(document).on('click', '.deleteCart', function () {
                var carts = JSON.parse(localStorage.getItem('cart'));
                var id = Number($(this).data('id'));
                alert('Bạn có chắc chắn muốn xóa sản phẩm này khỏi giỏ hàng?');
                $(`#itemCart-${id}`).remove();
                var newCarts = carts.filter(cart => cart.id != id);
                localStorage.setItem('cart', JSON.stringify(newCarts));
                tocart();
            });

            // Cập nhật số lượng sản phẩm
            $(document).on('change', '.quantityCart', function () {
                var carts = JSON.parse(localStorage.getItem('cart'));
                var id = Number($(this).data('id'));
                var quantity = Number($(this).val());
                if (quantity < 1) {
                    quantity = 1;
                    $(this).val(1);
                }

                var newCarts = carts.map(cart => {
                    if (cart.id == id) {
                        cart.quantity = quantity;
                    }
                    return cart;
                });
                localStorage.setItem('cart', JSON.stringify(newCarts));
                displayCart();
                tocart();
            });

            // Xác nhận thanh toán
            $('#paymentConfirmationModal').on('show.bs.modal', function () {
                // Get the current carts from localStorage
                var carts = JSON.parse(localStorage.getItem('cart'));
                var total = 0;
                var orderDetails = "";
                //thông tin người dùng
                var currentUser = {
                    username: 'Nguyễn Văn A',
                    sdt: '0123456789',
                    address: '123 Đường ABC, Quận XYZ, Thành phố HCM'
                    ,
                }

                orderDetails += '<h5>Thông tin khách hàng:</h5>';
                orderDetails += `<p>Tên: ${currentUser.username}</p>`;
                orderDetails += `<p>Địa chỉ: ${currentUser.address}</p>`;
                orderDetails += `<p>Số điện thoại: ${currentUser.sdt}</p>`;

                orderDetails += '<hr>';
                orderDetails += '<h5>Thông tin đơn hàng:</h5>';
                orderDetails += '<table class="table">';
                orderDetails += '<thead><tr><th>Tên sách</th><th>Số lượng</th><th>Giá</th><th>Thành tiền</th></tr></thead>';
                orderDetails += '<tbody>';
                carts.forEach(cart => {
                    var book = books.find(book => book.id == cart.id_book);
                    if (book) {
                        var tocart = cart.quantity * book.price;
                        total += cart.quantity * book.price;
                        orderDetails += `<tr><td>${book.title}</td><td>${cart.quantity}</td><td>${book.price.toLocaleString('vi-VN')} đ</td><td>${tocart.toLocaleString('vi-VN')} đ</td></tr>`;
                    }
                });
                orderDetails += '</tbody></table>';
                orderDetails += `<h5>Tổng số tiền: $${total.toLocaleString('vi-VN')} đ</h5>`;
                // Update the modal body with the order details
                $('.modal-body').html(orderDetails);
            });
            // thanh toán thành công
            $('#paymentConfirmation').click(function () {
                // alert('Thanh toán thành công!');
                localStorage.removeItem('cart');
                tocart();
                displayCart();
                // Close the modal
                // $('#paymentConfirmationModal').modal(' data-bs-dismiss="modal"');
            });
        });
    </script>

</body>

</html>